/*
 * This Java source file was generated by the Gradle 'init' task.
 */
package org.hyperledger.besu.secp256r1.demo;

import org.hyperledger.besu.secp256r1.demo.Web3jNist.NistTransactionManager;
import org.hyperledger.besu.secp256r1.demo.contract.DemoErc20;
import org.web3j.crypto.Credentials;
import org.web3j.protocol.Web3j;
import org.web3j.protocol.core.methods.response.TransactionReceipt;
import org.web3j.protocol.http.HttpService;
import org.web3j.tx.gas.DefaultGasProvider;

import java.math.BigInteger;

public class App {
    public static void main(String[] args) throws Exception {
        Credentials owner = Credentials.create(
                "24af1f94b309dc185e543407020f47ad483df8c19d4e10e6b7c9d3fd055651e8",
                "55c13b3f34db03306c367f18c951ca96d7d5288f22234c5396558f88c4430178cebad90993b6f08e23b190796159d09838715b0b2f65d69b1ae91f93ea8c6775");

        System.out.println("Owner address: " + owner.getAddress());

        Credentials user = Credentials.create(
                "24af1f94b309dc185e543407020f47ad483df8c19d4e10e6b7c9d3fd055651e8",
                "55c13b3f34db03306c367f18c951ca96d7d5288f22234c5396558f88c4430178cebad90993b6f08e23b190796159d09838715b0b2f65d69b1ae91f93ea8c6775");

        System.out.println("User address: " + user.getAddress());

        Web3j web3j = Web3j.build(new HttpService("http://127.0.0.1:8545"));
        NistTransactionManager transactionManagerOwner = new NistTransactionManager(web3j, owner);
        NistTransactionManager transactionManagerUser = new NistTransactionManager(web3j, user);

        DemoErc20 tokenOwner = DemoErc20.deploy(web3j, transactionManagerOwner, new DefaultGasProvider()).send();

        System.out.println("Contract deployed at " +  tokenOwner.getContractAddress());
        System.out.println("Contract deployed tx id " +  tokenOwner.getTransactionReceipt().get().getTransactionHash());

        BigInteger decimals = tokenOwner.decimals().send();
        BigInteger transferAmountOwner = BigInteger.valueOf(10).multiply(decimals);

        TransactionReceipt receiptTransferOwner = tokenOwner.transfer(user.getAddress(), transferAmountOwner).send();
        System.out.println("Sent 10 tokens to " + user.getAddress() + ": " + receiptTransferOwner.getTransactionHash());

        DemoErc20 tokenUser = DemoErc20.load(tokenOwner.getContractAddress(), web3j, transactionManagerUser, new DefaultGasProvider());

        BigInteger transferAmountUser = BigInteger.valueOf(5).multiply(decimals);

        TransactionReceipt receiptTransferUser = tokenUser.transfer(owner.getAddress(), transferAmountUser).send();
        System.out.println("Sent 5 tokens to " + owner.getAddress() + ": " + receiptTransferUser.getTransactionHash());
    }
}
